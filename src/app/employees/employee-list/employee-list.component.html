<div class="col-md-12" id="searchForm">
  <form [formGroup]="searchForm" autocomplete="off">
    <mat-card-title>
      <div class="row search-bar-group">
        <div class="title">
          Lista
        </div>
        <mat-form-field class="bar">
          <input #search matInput formControlName="search" placeholder="Qual funcionário você procura?" autocomplete="off">
        </mat-form-field>
        <div class="buttons">
          <a mat-button (click)="search.focus()">
            <mat-icon>search</mat-icon>
          </a>
          <a mat-button (click)="filter = !filter" [class.filter-button-active]="hasFilterActive">
            <mat-icon>keyboard_arrow_down</mat-icon>
          </a>
          <a [routerLink]="['/employees/new']" mat-button>
            <mat-icon>add</mat-icon>
          </a>
        </div>
      </div>
    </mat-card-title>
    <mat-card *ngIf="filter" class="filter-grid">
      <div class="row">
        <div class="col-md-12">
          <mat-form-field class="col-md-4">
            <input matInput formControlName="search" placeholder="Nome">
          </mat-form-field>
          <mat-form-field class="col-md-4">
            <mat-select placeholder="Função" formControlName="position" [compareWith]="comparePosition">
              <mat-option></mat-option>
              <mat-option *ngFor="let position of positions" [value]="position">
                {{ position.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field class="col-md-4">
            <mat-select placeholder="Departamento" formControlName="department" [compareWith]="compareDepartment">
              <mat-option></mat-option>
              <mat-option *ngFor="let department of departments" [value]="department">
                {{ department.description }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <div *ngIf="hasFilterActive" class="col-md-12">
            <mat-card-actions class="col-md-12 text-right">
              <button (click)="clearFilter()" class="cb-button" mat-raised-button>LIMPAR</button>
            </mat-card-actions>
          </div>
        </div>
      </div>
    </mat-card>
    <mat-paginator *ngIf="employees" [length]="pagination?.total" [pageSize]="pagination?.per_page" [pageIndex]="pageIndex" [pageSizeOptions]="[pagination?.per_page]"
      (page)="changePage($event)"></mat-paginator>
    <mat-card>
      <div *ngIf="employees?.length > 0">
        <table class="table mat-table">
          <div class="mat-header-row">
            <div class="mat-header-cell mat-column-name">Nome</div>
            <div class="mat-header-cell mat-column-position">Função</div>
            <div class="mat-header-cell mat-column-department">Departamento</div>
            <div class="mat-header-cell mat-column-action">Ação</div>
          </div>
          <div class="mat-row" *ngFor="let employee of employees" [class.deleted]="employee.deleted_at != null" [@rowAppeared]="rowAppearedState">
            <div class="mat-cell mat-column-name">
              {{ employee.name }}
            </div>
            <div class="mat-cell mat-column-position">
              {{ employee.position.name }}
            </div>
            <div class="mat-cell mat-column-department">
              {{ employee.department.description }}
            </div>
            <div class="mat-cell mat-column-action">
              <mat-menu #menu="matMenu">
                <a [disabled]="!permissionVerify('show', employee)" [routerLink]="permissionVerify('show', employee) ? ['/employees/show', employee.id] : null"
                  mat-menu-item>
                  <mat-icon>subject</mat-icon> Detalhes
                </a>
                <a [disabled]="!permissionVerify('edit', employee)" [routerLink]="permissionVerify('edit', employee) ? ['/employees/edit', employee.id] : null"
                  mat-menu-item>
                  <mat-icon>mode_edit</mat-icon> Editar
                </a>
                <button *ngIf="employee.deleted_at == null"
                [disabled]="!permissionVerify('toggle-deleted', employee)"
                (click)="toggleDeleted(employee)" mat-menu-item>
                  <mat-icon>delete</mat-icon> Desativar
                </button>
                <button *ngIf="employee.deleted_at != null"
                [disabled]="!permissionVerify('toggle-deleted', employee)"
                (click)="toggleDeleted(employee)" mat-menu-item>
                  <mat-icon>undo</mat-icon> Restaurar
                </button>
              </mat-menu>

              <button mat-icon-button [matMenuTriggerFor]="menu">
                <mat-icon>menu</mat-icon>
              </button>
            </div>
          </div>
        </table>
      </div>
      <div *ngIf="searching" class="col-md-12 records-not-found">
        <p>
          <small>
            Aguarde...
          </small>
        </p>
      </div>
      <div *ngIf="employees.length == 0 && searchForm.controls.search.value != '' && !searching" class="col-md-12 records-not-found">
        <p>
          <small>
            Não encontramos resultados para sua busca. :(
          </small>
        </p>
      </div>
      <div *ngIf="employees.length == 0 && searchForm.controls.search.value == '' && !searching" class="col-md-12 records-not-found">
        <p>
          <small>
            Ainda não existe nenhum funcionário cadastrado. Que tal
            <a [routerLink]="['/employees/new']">cadastrar</a> agora?
          </small>
        </p>
      </div>
    </mat-card>
    <mat-card-title>
      <div class="row search-bar-group">
        <div class="title">
          Relatório
        </div>
      </div>
    </mat-card-title>
    <mat-card>
      <table class="table mat-table report">
        <div class="mat-header-row">
          <div class="mat-header-cell col-md-2 text-center">Total</div>
        </div>
        <div class="mat-row">
          <div class="mat-cell col-md-2 text-center">{{ total(employees) }}</div>
          <div class="mat-cell col-md-10 text-right">
            {{ dataInfo?.updatedInfo?.date }}
            <p class="updated-info-employee">
              {{ dataInfo?.updatedInfo?.employee }}
            </p>
          </div>
        </div>
      </table>
    </mat-card>
    <mat-paginator *ngIf="employees" [length]="pagination?.total" [pageSize]="pagination?.per_page" [pageIndex]="pageIndex" [pageSizeOptions]="[pagination?.per_page]"
      (page)="changePage($event)"></mat-paginator>
  </form>
</div>

<div class="col-md-12 button-section">
  <a class="cb-button" [routerLink]="['/employees/import']" mat-raised-button>
    Importar
  </a>
</div>
