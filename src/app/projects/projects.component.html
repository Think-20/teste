<mat-accordion>
  <mat-expansion-panel *ngFor="let task of sortedTasks; let i = index" [expanded]="i == expandedIndex">
    <mat-expansion-panel-header>
      <mat-panel-title>
        <p class="lead">
          <span>{{ taskService.jobDisplay(task) }}</span>
          <br>
          <span *ngIf="task?.project_files?.length > 0" class="lead subtitle">{{ task?.project_files[task.project_files.length - 1]?.responsible?.name + ' | ' + (task.project_files[task.project_files.length - 1].updated_at | date: 'dd/MM/yyyy HH:mm') }}</span>
        </p>
      </mat-panel-title>
    </mat-expansion-panel-header>
    <cb-file-upload [properties]="{ task : task }" [files]="task.project_files" [fileServiceInterface]="projectFileService" [typeForm]="typeForm"></cb-file-upload>
    <button mat-button matTooltip="Download completo" class="aux-button"
      type="button" (click)="downloadAll()">
      <mat-icon>folder</mat-icon>
    </button>
    <div class="row">
      <div class="col-md-12">
        <button *ngIf="showButtonSpecification(task)"
          mat-button matTooltip="Ir para próxima etapa" class="cb-button button-specification"
          type="button" (click)="navigateToSpecification()">
          PRÓXIMO
        </button>
      </div>
    </div>
    <cb-budget-form *ngIf="task?.project_files?.length > 0" class="inside-mat-card" [task]="task" [job]="job"></cb-budget-form>
  </mat-expansion-panel>
</mat-accordion>

