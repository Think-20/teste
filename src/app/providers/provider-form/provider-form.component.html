<div class="col-md-12">
  <form [formGroup]="providerForm" novalidate autocomplete="off">
    <md-card-title>
      <p class="lead">Dados do fornecedor</p>
    </md-card-title>
    <md-card>
      <div class="row">
          <md-input-container class="col-md-3">
            <input formControlName="fantasy_name" mdInput placeholder="Nome*">
            <md-error>
              Obrigatório, entre 3 e 30 caract. 
            </md-error>
          </md-input-container>
          <md-input-container class="col-md-9">
            <input formControlName="name" mdInput placeholder="Razão social*">
            <md-error>
              Obrigatório, entre 3 e 50 caract. 
            </md-error>
          </md-input-container>
          <md-select class="col-md-3" placeholder="Tipo*" formControlName="person_type" [compareWith]="comparePersonType">
            <md-option *ngFor="let personType of personTypes" [value]="personType">
              {{ personType.description }}
            </md-option>
          </md-select>
          <md-select class="col-md-3" placeholder="Atendimento*" formControlName="employee" [compareWith]="compareEmployee">
            <md-option *ngFor="let employee of employees" [value]="employee">
              {{ employee.name }}
            </md-option>
          </md-select>
          <md-input-container class="col-md-3">
            <input formControlName="site" mdInput placeholder="Site">
            <md-error>
              7 caract. 
            </md-error>
          </md-input-container>
          <cb-stars class="col-md-3 star-input" label="Score" [rate]="provider != undefined ? (provider.rate + 1) : 0" [input]="providerForm.controls.rate">
            <input formControlName="rate" mdInput>
          </cb-stars>
          <md-input-container *ngIf="providerForm.get('person_type').value?.id == 1" class="col-md-3">
            <input formControlName="cpf" mask="999.999.999-99" mdInput placeholder="CPF*">
            <md-error>
              Obrigatório
            </md-error>
          </md-input-container>
          <md-input-container *ngIf="providerForm.get('person_type').value?.id == 2" class="col-md-3">
            <input formControlName="cnpj" mask="99.999.999/9999-99" mdInput placeholder="CNPJ*">
            <md-error>
              Obrigatório
            </md-error>
          </md-input-container>
          <md-input-container class="col-md-3">
            <input formControlName="ie" mask="999.999.999.999" mdInput placeholder="Inscrição estadual">
          </md-input-container>
          <md-input-container class="col-md-3">
            <input formControlName="mainphone" mask="(99) 9999-9999?9" mdInput placeholder="Telefone principal*">
            <md-error>
              Obrigatório
            </md-error>
          </md-input-container>
          <md-input-container class="col-md-3">
            <input formControlName="secundaryphone" mask="(99) 9999-9999?9" mdInput placeholder="Telefone secundário">
          </md-input-container>
          <div class="form-array" formArrayName="contacts">
            <div *ngFor="let control of getContactsControls(providerForm); let i = index">
              <form [formGroup]="getContactsControls(providerForm)[i]" novalidate autocomplete="off" class="flex contact-item">
                <md-input-container class="col-md-3">
                  <input formControlName="id" type="hidden">
                  <input formControlName="name" mdInput placeholder="Contato*">
                  <md-error>
                    Obrigatório, mínimo 3 caract.
                  </md-error>
                </md-input-container>
                <md-input-container class="col-md-3">
                  <input formControlName="email" mdInput placeholder="E-mail*">
                  <md-error>
                    Obrigatório, tipo e-mail.
                  </md-error>
                </md-input-container>
                <md-input-container class="col-md-3">
                  <input formControlName="department" mdInput placeholder="Departamento*">
                  <md-error>
                    Obrigatório, mínimo 3 caract.
                  </md-error>
                </md-input-container>
                <md-input-container class="col-md-3">
                  <input formControlName="cellphone" mask="(99) 9999-9999?9" mdInput placeholder="Celular">
                  <md-error>
                    Tipo telefone
                  </md-error>
                </md-input-container>
                <button *ngIf="i > 0" type="button" class="delete-contact" (click)="deleteContact(i)" md-button>
                  <md-icon>clear</md-icon>
                </button>
              </form>
            </div>
          </div>
          <div *ngIf="getContactsControls(providerForm).length > 0" class="col-md-12">
            <button type="button" class="add-contact" (click)="addContact()" md-button>
              <md-icon>add</md-icon>
            </button>
          </div>
          <div class="form-array" formArrayName="contacts">
            <div *ngFor="let control of getAccountsControls(providerForm); let i = index">
              <form [formGroup]="getAccountsControls(providerForm)[i]" novalidate autocomplete="off" class="flex contact-item">
                <md-input-container class="col-md-3">
                  <input formControlName="id" type="hidden">
                  <input formControlName="favored" mdInput placeholder="Favorecido*">
                  <md-error>
                    Obrigatório, mínimo 3 caract.
                  </md-error>
                </md-input-container>
                <md-input-container class="col-md-2">
                  <input formControlName="agency" mdInput placeholder="Agência*">
                  <md-error>
                    Obrigatório, mínimo 4 dígitos
                  </md-error>
                </md-input-container>
                <md-input-container class="col-md-2">
                  <input formControlName="account_number" mdInput placeholder="Número*">
                  <md-error>
                    Obrigatório, mínimo 6 dígitos
                  </md-error>
                </md-input-container>
                <md-select class="col-md-3" placeholder="Tipo de conta*" formControlName="bank_account_type" [compareWith]="compareBankAccountType">
                  <md-option *ngFor="let bankAccountType of bankAccountTypes | async" [value]="bankAccountType">
                    {{ bankAccountType.description }}
                  </md-option>
                </md-select>
                <md-select class="col-md-2" placeholder="Banco*" formControlName="bank" [compareWith]="compareBank">
                  <md-option *ngFor="let bank of banks | async" [value]="bank">
                    {{ bank.name }}
                  </md-option>
                </md-select>
                <button *ngIf="i > 0" type="button" class="delete-account" (click)="deleteAccount(i)" md-button>
                  <md-icon>clear</md-icon>
                </button>
              </form>
            </div>
          </div>
          <div *ngIf="getAccountsControls(providerForm).length > 0" class="col-md-12">
            <button type="button" class="add-account" (click)="addAccount()" md-button>
              <md-icon>add</md-icon>
            </button>
          </div>
          <md-input-container class="col-md-12">
            <textarea formControlName="note" mdInput placeholder="Observação: Indicação, já nos conhecia, como chegou até nós..."></textarea>
          </md-input-container>
      </div>
    </md-card>
    <md-card-title>
      <p class="lead">
        Endereço
      </p>
    </md-card-title>
    <md-card>
      <div class="row">
          <md-input-container class="col-md-3">
            <input formControlName="cep" mask="99999-999" mdInput placeholder="CEP*">
            <md-error>
              Obrigatório
            </md-error>
          </md-input-container>
          <md-input-container class="col-md-6">
            <input formControlName="street" mdInput placeholder="Logradouro*">
            <md-error>
              Obrigatório, entre 3 e 50 caract. 
            </md-error>
          </md-input-container>
          <md-input-container class="col-md-3">
            <input formControlName="number" mdInput placeholder="Número*">
            <md-error>
              Obrigatório, entre 1 e 11 caract. 
            </md-error>
          </md-input-container>
          <md-input-container class="col-md-3">
            <input formControlName="complement" mdInput placeholder="Complemento">
          </md-input-container>
          <md-input-container class="col-md-2">
            <input mdInput formControlName="state" [mdAutocomplete]="autocompleteState" placeholder="Estado*">
            <md-error>
              Obrigatório
            </md-error>
          </md-input-container>
          <md-autocomplete #autocompleteState="mdAutocomplete" [displayWith]="displayState">
              <md-option *ngFor="let state of states | async" [value]="state">
                {{ state.code }}
              </md-option>
          </md-autocomplete>
          <md-input-container class="col-md-4">
            <input mdInput formControlName="city" [mdAutocomplete]="autocompleteCity" placeholder="Cidade*">
            <md-error>
              Obrigatório
            </md-error>
          </md-input-container>
          <md-autocomplete #autocompleteCity="mdAutocomplete" [displayWith]="displayCity">
              <md-option *ngFor="let city of cities | async" [value]="city">
                {{ city.name }}
              </md-option>
          </md-autocomplete>
          <md-input-container class="col-md-3">
            <input formControlName="neighborhood" mdInput placeholder="Bairro*">
            <md-error>
              Obrigatório, entre 3 e 30 caract. 
            </md-error>
          </md-input-container>
      </div>
      <md-card-actions class="col-md-12 text-right">
        <button class="cb-button" *ngIf="typeForm === 'new'" color="primary" (click)="save(providerForm.value)" md-raised-button>
          SALVAR
        </button>
        <button class="cb-button" *ngIf="typeForm === 'edit'" color="primary" (click)="edit(providerForm.value, provider.id)" md-raised-button>
          EDITAR
        </button>
      </md-card-actions>
    </md-card>
  </form>
</div>